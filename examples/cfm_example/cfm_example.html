<br>
<h2>Calculation of synthetic color flow mapping image
</h2>
<br>

<p>
The CFM phantom simulation is used for evaluating color flow imaging. It generates
data for flow in vessels with properties like the carotid artery,
The velocity profile is close to parabolic, which is a fairly good approximation
during most of the cardiac cycle (Jensen, 1996) for a carotid artery.
The phantom generates 10 files with positions of the scatterers at the
corresponding time step. From file to file the scatterers are then propagated to
the next position as a function of their velocity and the time
between pulses. The ten files are then used for generating the
RF lines for the different imaging directions and for ten different
times. A linear scan of the phantom was made
with a 192 element transducer using 64 active elements with
a Hanning apodization in transmit and receive. The element height was
10 mm, the width was a wavelength and the kerf 0.05 mm.  An F-number of 2 was used in receive. 
 A single transmit focus was placed at 40 mm, and receive focusing was done at 2 mm
intervals from 10 mm from the transducer surface.
The resulting signals have then been used in a standard autocorrelation
estimator with RF averaging (Jensen, 1996) for finding the velocity image.
</p>

<p>
The example was modified in October 2022 to update the m-files to have a single file
with all parameters and the focusing was optimized to yield better results.
</p>

<p>
The resulting color flow image is shown below.
<center>
<img src="examples/cfm_example/cfm_image.png" width="250"><br><br>
<em>CFM image of vessel with parabolic flow.</em>
</center>
</p>

<p>
The m-files can be found at:
<center>
 <a href="examples/ftp_files/cfm_image/">
          examples/ftp_files/cfm_image/</a>
</center>
</p>

<p>
The routine <em>field.m</em> initializes the field system, and should be modified
to point to the directory holding the Field II code and m-files. The routine
<em>make_sct.m</em> is then called to make the file for the scatterers in the
phantom. The script <em>sim_flow.m</em> is then called. Here the field simulation
is performed and the data is stored in RF-files; one for each RF-line done.
The script <em>sim_img.m</em> is used for making the B-mode image as generated
by <em>tissue_pht.m</em>. The images are then generated by the routines
<em>cfm_bmode.m</em> and <em>cfm_image.m</em>. The routine <em>define_parameters.m</em>
hold all the common parameters for the simulation and imaging.
</p>

<hr>

<h2>References:</h2>
<br>

<p>
Jørgen Arendt Jensen: <A HREF="http://server.elektro.dtu.dk/personal/jaj/?jaj/research/book.html">
<em>"Estimation of Blood Velocities Using Ultrasound, A Signal Processing Approach"</em></A>,
Cambridge University Press, 1996.
</p>
<br>


